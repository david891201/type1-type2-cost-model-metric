本專案使用金融機構提供的保險業務員舞弊資料集，納入成本分析的觀點，提出一個評估模型成效的新方法，並將該方法套用在Random Forest、XGBoost 以及 VotingClassifier 三種機器學習模型上，根據我們提出的新指標，比較哪一種模型在偵測業務員舞弊的成效最佳。

過去在極度不平衡資料集的分類任務，評估應該使用哪一組超參數作為模型訓練使用時，通常採用 Precision、PR-AUC 等指標來衡量各超參數組合的表現。然而前述指標並未考慮到型 1 錯誤(無辜業務員被誤判)和型 2 錯誤(真正舞弊的人未被及時發現)的成本。實際上型 2 錯誤的成本會遠大於型 1 錯誤，若單純使用 Precision 或 PR-AUC 衡量，有可能會出現「Precision 最好，但實際付出的成本不一定為最低」的情況。因此本研究採用另外一種「納入成本分析觀點」的方式評估超參數組合的成效，成本越低代表模型表現越好。以下使用成本分析表範例進行說明：

## 模型效能指標表

| % | >=門檻的樣本數 | Fraud N | Capture | Fraud N Capture Times | 成本 |
|:--:|:---------------:|:--------:|:--------:|:----------------------:|:----:|
| 1 | 60 | 9 | 0.23 | 23.08 | 3060 |
| 2 | 120 | 12 | 0.31 | 15.38 | 2820 |
| 3 | 180 | 12 | 0.31 | 10.26 | 2880 |
| 4 | 240 | 14 | 0.36 | 8.97 | 2740 |
| 5 | 300 | 15 | 0.38 | 7.69 | 2700 |
| 10 | 600 | 17 | 0.44 | 4.36 | 2800 |
| 20 | 1200 | 20 | 0.51 | 2.56 | 3100 |
| 30 | 1800 | 24 | 0.62 | 2.05 | 3300 |
| 40 | 2400 | 29 | 0.74 | 1.86 | 3400 |
| 50 | 3000 | 30 | 0.77 | 1.54 | 3900 |
| 60 | 3600 | 32 | 0.82 | 1.37 | 4300 |
| 70 | 4200 | 36 | 0.92 | 1.32 | 4500 |
| 80 | 4800 | 38 | 0.97 | 1.22 | 4900 |
| 90 | 5414 | 38 | 0.97 | 1.08 | 5514 |
| 100 | 6000 | 39 | 1.00 | 1.00 | 6000 |

## 指標說明

- **%（門檻值）**  
  取預測機率排名前 *n%* 大的樣本作為模型預測為舞弊的人。

- **≥門檻的樣本數**  
  預測機率排名前 *n%* 大的樣本數量，也就是使用該門檻作為模型預測為舞弊的標準時，模型會預測出幾個人為舞弊。

- **Fraud N**  
  所有 ≥門檻的樣本（也就是模型預測為舞弊的人）裡面，實際上為真正舞弊的樣本數量。

- **Capture Fraud N**  
  `Fraud N / 實際上為真正舞弊的樣本總數`，衡量實際上為真正舞弊的樣本中，有多少比例被模型成功預測出來。

- **Capture Times**  
  `Fraud N / [(實際上為真正舞弊的樣本總數) × (門檻值%)]`  
  衡量模型預測是否優於隨機預測。  
  若等於 1 代表模型預測與隨機預測無差別；  
  若 > 1 代表模型能比隨機預測抓出更多舞弊樣本，數值越大代表模型效果越好。

- **成本（Cost）**  
  設單位成本為 `c`。  
  - 型一錯誤（誤判無辜業務員）→ 抽查成本  
  - 型二錯誤（未能抓出舞弊業務員）→ 裁罰及損失成本  
  假設型二錯誤的成本為型一錯誤的 100 倍，即：
  - 抽查成本 = `c`
  - 型二錯誤成本 = `100c`  
  總成本計算方式如下：

  <div align="center"> 

  **總成本 = (抽查成本 × ≥門檻的樣本數) + [型二錯誤成本 × (實際舞弊總數 − Fraud N)]**
  
  </div>

## 專案結構
```text
type1-type2-cost-model-metric/
├── src/                   
│   ├── utils.py
│   └── preprocessing/
│       └── preprocessing.py
├── config.yaml        # 管理整個過程會用到的各種參數
│                      # 包含型二錯誤的成本是型一錯誤的幾倍
│                      # 資料集放置的路徑
│                      # 哪些特徵需要經過缺失值處理等等
├── main.py
├── data/               # 存放原始與處理後資料
├── requirements.txt    # 需要安裝的 Python 套件
└── README.md           # 專案說明               
```

## 測試環境
Python 3.10.5

## 如何執行
1. 建立虛擬環境，虛擬環境所需要的套件以及版本皆已寫在requirements.txt
2. 準備好資料集，以及資料集前處理所需要的.pkl，並根據情境調整config.yaml裡面的參數後，於terminal執行
```text
python main.py
```
